# ğŸ–¥ï¸ åƒç´ é£ARPGæ¡Œé¢åº”ç”¨æ‰“åŒ…æ–¹æ¡ˆ

## ğŸ“Š æ‰“åŒ…æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | ä½“ç§¯ | æ€§èƒ½ | æ¨èåº¦ |
|------|------|------|------|------|--------|
| **Electron** | æˆç†Ÿç¨³å®šï¼Œç”Ÿæ€ä¸°å¯Œ | ä½“ç§¯å¤§ï¼Œå†…å­˜å ç”¨é«˜ | ~150MB | è‰¯å¥½ | â­â­â­â­â­ |
| **Tauri** | ä½“ç§¯å°ï¼Œæ€§èƒ½å¥½ | ç”Ÿæ€è¾ƒæ–°ï¼Œå­¦ä¹ æˆæœ¬ | ~15MB | ä¼˜ç§€ | â­â­â­â­ |
| **Neutralino** | è½»é‡çº§ | åŠŸèƒ½æœ‰é™ | ~10MB | è‰¯å¥½ | â­â­â­ |
| **PWA+å·¥å…·** | ç®€å•å¿«é€Ÿ | åŠŸèƒ½å—é™ | å° | ä¸­ç­‰ | â­â­ |

## ğŸ¯ æ¨èæ–¹æ¡ˆï¼šElectron (æ¸¸æˆæœ€ä½³é€‰æ‹©)

### ä¸ºä»€ä¹ˆé€‰æ‹©Electronï¼Ÿ
- âœ… **æ¸¸æˆå…¼å®¹æ€§æœ€ä½³** - Phaseråœ¨Electronä¸­è¿è¡Œå®Œç¾
- âœ… **APIä¸°å¯Œ** - æ”¯æŒæ–‡ä»¶ç³»ç»Ÿã€çª—å£ç®¡ç†ã€ç³»ç»Ÿé€šçŸ¥ç­‰
- âœ… **ç”Ÿæ€æˆç†Ÿ** - å¤§é‡æ¸¸æˆä½¿ç”¨(Discordã€Steamå®¢æˆ·ç«¯ç­‰)
- âœ… **å¼€å‘å‹å¥½** - ä¸ç°æœ‰WebæŠ€æœ¯æ ˆæ— ç¼é›†æˆ

### æ€§èƒ½è€ƒè™‘
å¯¹äºåƒç´ é£ARPGæ¸¸æˆï¼š
- CPUä½¿ç”¨: ä¸­ç­‰ (ä¸»è¦æ˜¯æ¸¸æˆé€»è¾‘)
- å†…å­˜ä½¿ç”¨: 100-300MB (å¯æ¥å—èŒƒå›´)
- å¯åŠ¨é€Ÿåº¦: 2-5ç§’ (åˆç†)
- æ¸¸æˆæ€§èƒ½: 60FPSç¨³å®š

## ğŸš€ Electroné›†æˆå®æ–½

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…Electronå¼€å‘ä¾èµ–

```bash
# å®‰è£…Electronç›¸å…³ä¾èµ–
npm install --save-dev electron
npm install --save-dev electron-builder
npm install --save-dev concurrently
npm install --save-dev wait-on

# å®‰è£…é¢å¤–çš„æ¡Œé¢åŠŸèƒ½
npm install --save electron-store      # æœ¬åœ°å­˜å‚¨
npm install --save electron-updater    # è‡ªåŠ¨æ›´æ–°
npm install --save electron-window-state # çª—å£çŠ¶æ€ä¿å­˜
```

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºElectronä¸»è¿›ç¨‹

```javascript
// electron/main.js
const { app, BrowserWindow, Menu, dialog, shell, ipcMain } = require('electron')
const { autoUpdater } = require('electron-updater')
const windowStateKeeper = require('electron-window-state')
const Store = require('electron-store')
const path = require('path')
const isDev = process.env.NODE_ENV === 'development'

// åˆå§‹åŒ–é…ç½®å­˜å‚¨
const store = new Store()

class PixelARPGApp {
  constructor() {
    this.mainWindow = null
    this.splashWindow = null
  }

  async initialize() {
    await app.whenReady()
    
    // åˆ›å»ºå¯åŠ¨ç”»é¢
    this.createSplashWindow()
    
    // é¢„åŠ è½½æ¸¸æˆèµ„æº
    setTimeout(() => {
      this.createMainWindow()
      this.closeSplashWindow()
    }, 3000)

    this.setupAppEvents()
    this.setupAutoUpdater()
    this.createMenus()
  }

  createSplashWindow() {
    this.splashWindow = new BrowserWindow({
      width: 400,
      height: 300,
      frame: false,
      alwaysOnTop: true,
      transparent: true,
      webPreferences: {
        nodeIntegration: false,
        contextIsolation: true
      }
    })

    this.splashWindow.loadFile('assets/splash.html')
  }

  createMainWindow() {
    // æ¢å¤çª—å£çŠ¶æ€
    let mainWindowState = windowStateKeeper({
      defaultWidth: 1920,
      defaultHeight: 1080
    })

    this.mainWindow = new BrowserWindow({
      x: mainWindowState.x,
      y: mainWindowState.y,
      width: mainWindowState.width,
      height: mainWindowState.height,
      minWidth: 1024,
      minHeight: 768,
      show: false,
      icon: path.join(__dirname, '../assets/icon.png'),
      webPreferences: {
        nodeIntegration: false,
        contextIsolation: true,
        enableRemoteModule: false,
        preload: path.join(__dirname, 'preload.js')
      }
    })

    // è®©windowStateKeeperç®¡ç†çª—å£
    mainWindowState.manage(this.mainWindow)

    // åŠ è½½æ¸¸æˆ
    if (isDev) {
      this.mainWindow.loadURL('http://localhost:5173')
      this.mainWindow.webContents.openDevTools()
    } else {
      this.mainWindow.loadFile('dist/index.html')
    }

    // çª—å£å‡†å¤‡å¥½åæ˜¾ç¤º
    this.mainWindow.once('ready-to-show', () => {
      this.mainWindow.show()
      
      // èšç„¦çª—å£
      if (isDev) {
        this.mainWindow.webContents.openDevTools()
      }
    })

    // è®¾ç½®çª—å£äº‹ä»¶
    this.mainWindow.on('closed', () => {
      this.mainWindow = null
    })

    // é˜²æ­¢æ–°çª—å£æ‰“å¼€
    this.mainWindow.webContents.setWindowOpenHandler(({ url }) => {
      shell.openExternal(url)
      return { action: 'deny' }
    })
  }

  closeSplashWindow() {
    if (this.splashWindow) {
      this.splashWindow.close()
      this.splashWindow = null
    }
  }

  createMenus() {
    const template = [
      {
        label: 'æ¸¸æˆ',
        submenu: [
          {
            label: 'æ–°æ¸¸æˆ',
            accelerator: 'CmdOrCtrl+N',
            click: () => {
              this.mainWindow.webContents.send('menu-new-game')
            }
          },
          {
            label: 'ä¿å­˜æ¸¸æˆ',
            accelerator: 'CmdOrCtrl+S',
            click: () => {
              this.mainWindow.webContents.send('menu-save-game')
            }
          },
          {
            label: 'åŠ è½½æ¸¸æˆ',
            accelerator: 'CmdOrCtrl+O',
            click: () => {
              this.mainWindow.webContents.send('menu-load-game')
            }
          },
          { type: 'separator' },
          {
            label: 'è®¾ç½®',
            click: () => {
              this.mainWindow.webContents.send('menu-settings')
            }
          },
          { type: 'separator' },
          {
            label: 'é€€å‡º',
            accelerator: process.platform === 'darwin' ? 'Cmd+Q' : 'Ctrl+Q',
            click: () => {
              app.quit()
            }
          }
        ]
      },
      {
        label: 'çª—å£',
        submenu: [
          {
            label: 'å…¨å±',
            accelerator: 'F11',
            click: () => {
              const isFullScreen = this.mainWindow.isFullScreen()
              this.mainWindow.setFullScreen(!isFullScreen)
            }
          },
          {
            label: 'æœ€å°åŒ–',
            accelerator: 'CmdOrCtrl+M',
            role: 'minimize'
          },
          {
            label: 'å…³é—­',
            accelerator: 'CmdOrCtrl+W',
            role: 'close'
          }
        ]
      }
    ]

    if (isDev) {
      template.push({
        label: 'å¼€å‘',
        submenu: [
          {
            label: 'é‡è½½',
            accelerator: 'CmdOrCtrl+R',
            click: () => {
              this.mainWindow.reload()
            }
          },
          {
            label: 'å¼€å‘è€…å·¥å…·',
            accelerator: 'F12',
            click: () => {
              this.mainWindow.webContents.toggleDevTools()
            }
          }
        ]
      })
    }

    const menu = Menu.buildFromTemplate(template)
    Menu.setApplicationMenu(menu)
  }

  setupAppEvents() {
    app.on('window-all-closed', () => {
      if (process.platform !== 'darwin') {
        app.quit()
      }
    })

    app.on('activate', () => {
      if (BrowserWindow.getAllWindows().length === 0) {
        this.createMainWindow()
      }
    })

    // IPCäº‹ä»¶å¤„ç†
    ipcMain.handle('get-app-version', () => {
      return app.getVersion()
    })

    ipcMain.handle('show-save-dialog', async () => {
      const result = await dialog.showSaveDialog(this.mainWindow, {
        filters: [
          { name: 'æ¸¸æˆå­˜æ¡£', extensions: ['sav'] }
        ]
      })
      return result
    })

    ipcMain.handle('show-open-dialog', async () => {
      const result = await dialog.showOpenDialog(this.mainWindow, {
        filters: [
          { name: 'æ¸¸æˆå­˜æ¡£', extensions: ['sav'] }
        ]
      })
      return result
    })

    // æ¸¸æˆæ•°æ®å­˜å‚¨
    ipcMain.handle('store-get', (event, key) => {
      return store.get(key)
    })

    ipcMain.handle('store-set', (event, key, value) => {
      store.set(key, value)
    })

    ipcMain.handle('store-delete', (event, key) => {
      store.delete(key)
    })
  }

  setupAutoUpdater() {
    if (!isDev) {
      autoUpdater.checkForUpdatesAndNotify()
      
      autoUpdater.on('update-available', () => {
        dialog.showMessageBox(this.mainWindow, {
          type: 'info',
          title: 'æ›´æ–°å¯ç”¨',
          message: 'å‘ç°æ–°ç‰ˆæœ¬ï¼Œæ­£åœ¨ä¸‹è½½...'
        })
      })

      autoUpdater.on('update-downloaded', () => {
        dialog.showMessageBox(this.mainWindow, {
          type: 'info',
          title: 'æ›´æ–°å°±ç»ª',
          message: 'æ›´æ–°å·²ä¸‹è½½ï¼Œé‡å¯åº”ç”¨ä»¥åº”ç”¨æ›´æ–°',
          buttons: ['é‡å¯', 'ç¨å']
        }).then((result) => {
          if (result.response === 0) {
            autoUpdater.quitAndInstall()
          }
        })
      })
    }
  }
}

// å¯åŠ¨åº”ç”¨
const pixelARPG = new PixelARPGApp()
pixelARPG.initialize()
```

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºé¢„åŠ è½½è„šæœ¬

```javascript
// electron/preload.js
const { contextBridge, ipcRenderer } = require('electron')

// å®‰å…¨åœ°æš´éœ²APIç»™æ¸²æŸ“è¿›ç¨‹
contextBridge.exposeInMainWorld('electronAPI', {
  // åº”ç”¨ä¿¡æ¯
  getVersion: () => ipcRenderer.invoke('get-app-version'),
  
  // æ–‡ä»¶å¯¹è¯æ¡†
  showSaveDialog: () => ipcRenderer.invoke('show-save-dialog'),
  showOpenDialog: () => ipcRenderer.invoke('show-open-dialog'),
  
  // æœ¬åœ°å­˜å‚¨
  store: {
    get: (key) => ipcRenderer.invoke('store-get', key),
    set: (key, value) => ipcRenderer.invoke('store-set', key, value),
    delete: (key) => ipcRenderer.invoke('store-delete', key)
  },
  
  // èœå•äº‹ä»¶ç›‘å¬
  onMenuAction: (callback) => {
    ipcRenderer.on('menu-new-game', callback)
    ipcRenderer.on('menu-save-game', callback)
    ipcRenderer.on('menu-load-game', callback)
    ipcRenderer.on('menu-settings', callback)
  },
  
  // ç§»é™¤ç›‘å¬å™¨
  removeAllListeners: (channel) => {
    ipcRenderer.removeAllListeners(channel)
  }
})
```

### ç¬¬å››æ­¥ï¼šæ›´æ–°æ‰“åŒ…é…ç½®

```json
// package.json
{
  "main": "electron/main.js",
  "homepage": "./",
  "scripts": {
    "electron": "concurrently \"npm run dev\" \"wait-on http://localhost:5173 && electron .\"",
    "electron:build": "npm run build && electron .",
    "dist": "npm run build && electron-builder",
    "dist:win": "npm run build && electron-builder --win",
    "dist:mac": "npm run build && electron-builder --mac",
    "dist:linux": "npm run build && electron-builder --linux"
  },
  "build": {
    "appId": "com.yourcompany.pixel-arpg",
    "productName": "åƒç´ é£æµæ”¾ä¹‹è·¯",
    "directories": {
      "output": "release"
    },
    "files": [
      "dist/**/*",
      "electron/**/*",
      "assets/**/*"
    ],
    "win": {
      "target": [
        {
          "target": "nsis",
          "arch": ["x64"]
        },
        {
          "target": "portable",
          "arch": ["x64"]
        }
      ],
      "icon": "assets/icon.ico"
    },
    "mac": {
      "target": "dmg",
      "icon": "assets/icon.icns"
    },
    "linux": {
      "target": "AppImage",
      "icon": "assets/icon.png"
    },
    "nsis": {
      "oneClick": false,
      "allowToChangeInstallationDirectory": true,
      "createDesktopShortcut": true,
      "createStartMenuShortcut": true
    }
  }
}
```

## ğŸ® æ¸¸æˆç‰¹å®šä¼˜åŒ–

### æ€§èƒ½ä¼˜åŒ–

```javascript
// åœ¨ä¸»è¿›ç¨‹ä¸­ä¼˜åŒ–æ¸¸æˆæ€§èƒ½
app.commandLine.appendSwitch('enable-gpu-rasterization')
app.commandLine.appendSwitch('enable-zero-copy')
app.commandLine.appendSwitch('ignore-gpu-blacklist')

// ç¦ç”¨ä¸éœ€è¦çš„åŠŸèƒ½
app.commandLine.appendSwitch('disable-software-rasterizer')
app.commandLine.appendSwitch('disable-background-timer-throttling')
```

### æ¸¸æˆå­˜æ¡£ç®¡ç†

```typescript
// src/infrastructure/ElectronStorage.ts
export class ElectronStorage {
  private isElectron = typeof window !== 'undefined' && window.electronAPI

  async saveGameData(data: any): Promise<void> {
    if (this.isElectron) {
      // ä½¿ç”¨Electronçš„å®‰å…¨å­˜å‚¨
      await window.electronAPI.store.set('gameData', data)
    } else {
      // å›é€€åˆ°localStorage
      localStorage.setItem('gameData', JSON.stringify(data))
    }
  }

  async loadGameData(): Promise<any> {
    if (this.isElectron) {
      return await window.electronAPI.store.get('gameData')
    } else {
      const data = localStorage.getItem('gameData')
      return data ? JSON.parse(data) : null
    }
  }

  async exportSave(): Promise<string | null> {
    if (this.isElectron) {
      const result = await window.electronAPI.showSaveDialog()
      if (!result.canceled) {
        const gameData = await this.loadGameData()
        // å†™å…¥æ–‡ä»¶é€»è¾‘
        return result.filePath
      }
    }
    return null
  }
}
```

## ğŸ¨ æ›¿ä»£æ–¹æ¡ˆï¼šTauri (æ¨èå°è¯•)

### Tauriçš„ä¼˜åŠ¿
- ğŸš€ **æå°ä½“ç§¯** (~15MB vs Electron ~150MB)
- âš¡ **æ›´å¥½æ€§èƒ½** (åŸç”ŸRuståç«¯)
- ğŸ”’ **æ›´é«˜å®‰å…¨æ€§** (é»˜è®¤å®‰å…¨é…ç½®)
- ğŸ’š **æ›´ä½èµ„æºå ç”¨**

### Taurié›†æˆæ­¥éª¤

```bash
# å®‰è£…Tauri CLI
npm install --save-dev @tauri-apps/cli
cargo install tauri-cli

# åˆå§‹åŒ–Tauri
npm run tauri init

# å¼€å‘æ¨¡å¼
npm run tauri dev

# æ„å»ºåº”ç”¨
npm run tauri build
```

```json
// tauri.conf.json
{
  "build": {
    "beforeBuildCommand": "npm run build",
    "beforeDevCommand": "npm run dev",
    "devPath": "http://localhost:5173",
    "distDir": "../dist"
  },
  "package": {
    "productName": "åƒç´ é£æµæ”¾ä¹‹è·¯",
    "version": "1.0.0"
  },
  "tauri": {
    "allowlist": {
      "all": false,
      "fs": {
        "all": true
      },
      "dialog": {
        "all": true
      }
    },
    "windows": [
      {
        "fullscreen": false,
        "height": 1080,
        "resizable": true,
        "title": "åƒç´ é£æµæ”¾ä¹‹è·¯",
        "width": 1920,
        "minHeight": 768,
        "minWidth": 1024
      }
    ]
  }
}
```

## ğŸ“¦ æ‰“åŒ…å’Œåˆ†å‘

### æ„å»ºå‘½ä»¤
```bash
# Electronæ‰“åŒ…
npm run dist:win  # Windows
npm run dist:mac  # macOS  
npm run dist:linux # Linux

# Tauriæ‰“åŒ…
npm run tauri build
```

### è¾“å‡ºæ–‡ä»¶
- **Windows**: `.exe` å®‰è£…åŒ… + ä¾¿æºç‰ˆ
- **macOS**: `.dmg` ç£ç›˜é•œåƒ
- **Linux**: `.AppImage` ä¾¿æºåº”ç”¨

### æ–‡ä»¶å¤§å°å¯¹æ¯”
- **Electronç‰ˆ**: ~200MB
- **Tauriç‰ˆ**: ~30MB
- **åŸWebç‰ˆ**: ~10MB

## ğŸš€ æ¨èå®æ–½æ–¹æ¡ˆ

### é˜¶æ®µä¸€ï¼šElectronå¿«é€Ÿå®ç°
1. ç«‹å³å¯ç”¨ï¼Œæ— éœ€å¤§æ”¹åŠ¨
2. å®Œæ•´çš„æ¡Œé¢åº”ç”¨åŠŸèƒ½
3. æˆç†Ÿçš„ç”Ÿæ€æ”¯æŒ

### é˜¶æ®µäºŒï¼šTauriä¼˜åŒ–ç‰ˆæœ¬
1. æ˜¾è‘—å‡å°ä½“ç§¯
2. æ›´å¥½çš„æ€§èƒ½è¡¨ç°  
3. ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆ

**å»ºè®®å…ˆç”¨Electronå¿«é€Ÿä¸Šçº¿ï¼Œç„¶åè€ƒè™‘Tauriä¼˜åŒ–ç‰ˆæœ¬ï¼** ğŸ¯ 